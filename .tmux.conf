# tmuxèµ·å‹•æ™‚ã®ã‚·ã‚§ãƒ«ã‚’zshã«ã™ã‚‹
set -g default-shell $SHELL

# Escã‚­ãƒ¼ã®é…å»¶ã‚’è§£æ¶ˆ
set -g escape-time 0

# nvimã®checkhealthã§WARNINGãŒå‡ºã¦ã„ãŸãŸã‚è¿½åŠ 
set -g focus-events on

set -g history-limit 30000

# vimãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ã‚’åˆ¤å®šã™ã‚‹
is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"

###########################################################
# å¤–è¦³
###########################################################

# tmuxã‚’256è‰²è¡¨ç¤ºã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
set -g default-terminal "tmux-256color"
set -as terminal-overrides ",$TERM:Tc"

# Undercurl
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'  # undercurl support
set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'  # underscore colours - needs tmux-3.0

# Check if we are in WSL
if-shell 'test -n "$WSL_DISTRO_NAME"' {
  set -as terminal-overrides ',*:Setulc=\E[58::2::::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m' # underscore colours - needs tmux-3.0 (wsl2 in Windows Terminal)
}

# message textï¼ˆå¯èª­æ€§å‘ä¸Šã®ãŸã‚å¤ªå­—ã‚’è¿½åŠ ï¼‰
set-option -g message-style bg="#FE9EA1",fg="#141B2E,bold"

############################
# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼
############################

# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼
## ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ã‚’ãƒˆãƒƒãƒ—ã«é…ç½®ã™ã‚‹
set -g status-position top

# ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ç•ªå·ã®å·¦å¯„ã›
set -g status-justify left

# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ã‚’æç”»ã—ç›´ã•ãªã„
set -g status-interval 0

# ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’1ã‹ã‚‰é–‹å§‹
set -g base-index 1

# ãƒšã‚¤ãƒ³ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’1ã‹ã‚‰é–‹å§‹
setw -g pane-base-index 1

# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ã®è‰²ã‚’è¨­å®šã™ã‚‹
set -g status-fg "#ffffff"
set -g status-bg "#141B2E"

# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼å·¦ã®ã‚µã‚¤ã‚º
set -g status-left-length 20

# è¡¨ç¤ºå†…å®¹
set -g status-left ''
# åŒæœŸãƒ¢ãƒ¼ãƒ‰ã¨ã‚³ãƒ”ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã®ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’è¿½åŠ 
set -g status-right '#[fg=#00BFFF,bold]#{?pane_synchronized,âš¡SYNC #[fg=#8F595B]â”Š,}#[fg=#FF8C00,bold]#{?pane_in_mode,ğŸ“‹ COPY #[fg=#8F595B]â”Š,}#[fg=#ffffff bold] #(date "+%Y/%m/%d %H:%M") #[fg=#8F595B]â”Š#[fg=#ffffff] #(date "+%a")  #[fg=#ffffff,bg=#141B2E]#[default]'
# ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦è¡¨ç¤ºã®æ”¹å–„
setw -g window-status-format "#[fg=#FFFFFF dim,bg=#141B2E,align=centre]  #W  #[default]"
# ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’ã‚ˆã‚Šå¼·èª¿
setw -g window-status-current-format "#[fg=#FE9EA1 bold,bg=#141B2E,align=centre]â–¶ #[fg=#FFFFFF]#W  #[default]"

############################
# ãƒšã‚¤ãƒ³
############################

# éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒšã‚¤ãƒ³ã¯èƒŒæ™¯è‰²ã‚’å¤‰ãˆã‚‹ï¼ˆã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆå‘ä¸Šã®ãŸã‚æš—ãï¼‰
set -g window-style 'bg=#0D1117'
set -g window-active-style 'bg=#141B2E'

# ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒšã‚¤ãƒ³ã®å¢ƒç•Œç·šã‚’ã‚ˆã‚Šæ˜ã‚‹ãç›®ç«‹ã¤è‰²ã«å¤‰æ›´
set -g pane-active-border-style "fg=#FE9EA1,bg=#141B2E"
set -g pane-border-style "fg=#737aa2,bg=#141B2E"

# ãƒšã‚¤ãƒ³æ¯ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
set -g pane-border-status bottom
# ãƒšã‚¤ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ã‚ˆã‚Šç°¡æ½”ã§è¦–èªæ€§ã®é«˜ã„è¡¨ç¤ºã«å¤‰æ›´
set -g pane-border-format "#[fg=#FE9EA1,bold]#{?pane_active,â–¶ ,  }#[fg=#ffffff]#{pane_current_command}#{?#{==:#{pane_current_command},ssh}, â†’ #(tmux-get-hostname.sh #{pane_current_command} #{pane_pid}),}  "
# set -g pane-border-format "#(tmux-pane-border.sh #{pane_current_path} #{pane_current_command} #{pane_pid})"

###########################################################
# ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ (normal mode)
###########################################################

# prefixã‚­ãƒ¼ã‚’C-oã«å¤‰æ›´
set -g prefix C-o

# C-bã®ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ã‚’è§£é™¤
unbind C-b

# r ã§è¨­å®šã‚’ãƒªãƒ­ãƒ¼ãƒ‰
bind r 'source-file ~/.tmux.conf; display " Reload config! (~/.tmux.conf)"'
# bind r if-shell "$is_vim" 'send-keys C-e r' 'source-file ~/.tmux.conf; display "Reload config! (~/.tmux.conf)"'
bind -n M-. source-file ~/.tmux.conf \; display " Reload config! (~/.tmux.conf)"

# ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’ä½œæˆ
bind -n 'M-c' 'new-window'
bind -n 'M-q' 'detach-client'

# x ã§ãƒšã‚¤ãƒ³ã‚’kill
bind -r x kill-pane
# bind -n M-x kill-pane

# ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ç§»å‹•
bind -r n 'next-window'
bind -r p 'previous-window'
bind -n M-n 'next-window'
bind -n M-b 'previous-window'

# vimã®ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ã§ãƒšã‚¤ãƒ³ã‚’ç§»å‹•ã™ã‚‹
bind h 'select-pane -L'
bind j 'select-pane -D'
bind k 'select-pane -U'
bind l 'select-pane -R'
bind -n M-h 'select-pane -L'
bind -n M-j 'select-pane -D'
bind -n M-k 'select-pane -U'
bind -n M-l 'select-pane -R'
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ä¸€è¦§
bind w 'choose-tree -s'
bind -n M-w 'choose-tree -s'

# ãƒšã‚¤ãƒ³ã®åˆ†å‰²
bind e split-window -h
bind i split-window -v
bind -n M-e split-window -h
bind -n M-i split-window -v

# ãƒã‚¦ã‚¹æ“ä½œã‚’æœ‰åŠ¹ã«ã™ã‚‹
set -g mouse on
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'copy-mode -e'"
bind a setw synchronize-panes \; display "synchronize-panes #{?pane_synchronized,on,off}"
bind -n M-a setw synchronize-panes \; display "synchronize-panes #{?pane_synchronized,on,off}"

# ãƒšã‚¤ãƒ³ã‚’ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã§æœ€å¤§åŒ–/å¾©å…ƒ
bind -n DoubleClick1Pane run-shell 'if [ "#{window_zoomed_flag}" = "1" ]; then tmux resize-pane -Z; else tmux resize-pane -Z; fi'

# ä¸­å¤®ã‚¯ãƒªãƒƒã‚¯ã§ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¡¨ç¤ºï¼ˆã‚ˆã‚Šä½¿ç”¨é »åº¦ã®é«˜ã„é …ç›®ã‚’ä¸Šéƒ¨ã«é…ç½®ï¼‰
unbind -n MouseDown2Pane
bind -n MouseDown2Pane      display-menu -T "#[align=centre]#{window_index}:#{window_name}" -t = -x W -y S \
  "#{?window_zoomed_flag,Unzoom,Zoom}"  z "resize-pane -Z"                                   \
  "#{?pane_marked,Unmark,Mark}"         m "select-pane -m"                                   \
  ""                                                                                         \
  "Split Horizontal"                    h "split-window -h"                                  \
  "Split Vertical"                      v "split-window -v"                                  \
  ""                                                                                         \
  "Swap Left"                           l "swap-window -t:-1"                                \
  "Swap Right"                          r "swap-window -t:+1"                                \
  "#{?pane_marked_set,,-}Swap Marked"   s swap-window                                        \
  ""                                                                                         \
  Kill                                  X kill-window                                        \
  Rename                                n "command-prompt -I \"#W\" \"rename-window -- '%%'\""

###########################################################
# ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ (copy mode)
###########################################################

# ã‚³ãƒ”ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã§vimã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ã‚’ä½¿ã†
setw -g mode-keys vi

# prefix + vã§ã‚³ãƒ”ãƒ¼ãƒ¢ãƒ¼ãƒ‰
bind v copy-mode \; display "Copy mode!"
bind -n M-v copy-mode \; display "Copy mode!"

# 'v' ã§é¸æŠã‚’å§‹ã‚ã‚‹
bind -T copy-mode-vi v send -X begin-selection

# 'V' ã§è¡Œé¸æŠ
bind -T copy-mode-vi V send -X select-line

# 'C-v' ã§çŸ©å½¢é¸æŠ
bind -T copy-mode-vi C-v send -X rectangle-toggle

# Escapeã§ã‚³ãƒ”ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã‚’çµ‚äº†
bind -T copy-mode-vi Escape send-keys -X cancel

# for WSL
# yã§ãƒ¤ãƒ³ã‚¯
bind -T copy-mode-vi y send -X copy-pipe-and-cancel "win32yank.exe -i" \; display "Copy!"

## Enterã§ãƒ¤ãƒ³ã‚¯
unbind -T copy-mode-vi Enter
bind -T copy-mode-vi Enter send -X copy-pipe-and-cancel "win32yank.exe -i" \; display "Copy!"

# ãƒ‰ãƒ©ãƒƒã‚°ã§ãƒ¤ãƒ³ã‚¯
# unbind -T copy-mode-vi MouseDragEnd1Pane

# å³ã‚¯ãƒªãƒƒã‚¯ã§ãƒšãƒ¼ã‚¹ãƒˆ
unbind -n MouseDown3Pane
bind -n MouseDown3Pane run "win32yank.exe -o | tmux load-buffer - && tmux paste-buffer"

# *ã§ã¯ã‚Šã¤ã‘
bind p run "win32yank.exe -o | tmux load-buffer - && tmux paste-buffer"
bind -n M-p run "win32yank.exe -o | tmux load-buffer - && tmux paste-buffer"

###########################################################
# è¿½åŠ ã®ä¾¿åˆ©ãªã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
###########################################################

# ãƒšã‚¤ãƒ³ã®å…¥ã‚Œæ›¿ãˆï¼ˆswap-paneï¼‰
bind -n M-o swap-pane -D
bind -n M-O swap-pane -U

# æœ€å¾Œã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã¸ã®åˆ‡ã‚Šæ›¿ãˆ
bind -n M-Tab last-window

# ãƒšã‚¤ãƒ³ã‚’æ–°ã—ã„ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã¸ç§»å‹•
bind -n M-! break-pane

# ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ‡ã‚Šæ›¿ãˆã‚’ç°¡å˜ã«
bind -n M-s choose-session -Z

